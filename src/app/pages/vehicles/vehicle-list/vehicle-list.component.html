<div class="vehicle-list">
  <div class="header">
    <h1>Veículos</h1>
    <div class="header-actions">
      <button (click)="toggleFilters()" class="btn btn-secondary">
        <i class="fas fa-filter"></i> {{ showFilters ? 'Ocultar Filtros' : 'Filtrar' }}
      </button>
      <button routerLink="/vehicles/new" class="btn btn-primary">
        <i class="fas fa-plus"></i> Novo Veículo
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters" *ngIf="showFilters">
    <div class="filter-form">
      <div class="form-row">
        <div class="form-group">
          <label for="filterLicensePlate">Placa</label>
          <input 
            type="text" 
            id="filterLicensePlate" 
            [(ngModel)]="filters.licensePlate" 
            placeholder="Placa do veículo"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterBrand">Marca</label>
          <input 
            type="text" 
            id="filterBrand" 
            [(ngModel)]="filters.brand" 
            placeholder="Marca"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterModel">Modelo</label>
          <input 
            type="text" 
            id="filterModel" 
            [(ngModel)]="filters.model" 
            placeholder="Modelo"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterYearFrom">Ano (De)</label>
          <input 
            type="number" 
            id="filterYearFrom" 
            [(ngModel)]="filters.yearFrom" 
            placeholder="Ano inicial"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterYearTo">Ano (Até)</label>
          <input 
            type="number" 
            id="filterYearTo" 
            [(ngModel)]="filters.yearTo" 
            placeholder="Ano final"
            class="form-control">
        </div>
      </div>

      <div class="filter-actions">
        <button (click)="applyFilters()" class="btn btn-primary">
          <i class="fas fa-search"></i> Buscar
        </button>
        <button (click)="clearFilters()" class="btn btn-secondary">
          <i class="fas fa-times"></i> Limpar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div class="table-container" *ngIf="!loading && !error">
    <!-- Informações de paginação -->
    <div class="pagination-info">
      <div class="results-info">
        Mostrando {{ vehicles.length }} de {{ totalElements }} veículos
      </div>
      <div class="page-size-selector">
        <label for="pageSize">Itens por página:</label>
        <select id="pageSize" [(ngModel)]="pageSize" (change)="changePageSize()" class="form-control">
          <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
        </select>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th (click)="sort('licensePlate')" class="sortable">
            Placa <i [class]="getSortIcon('licensePlate')"></i>
          </th>
          <th>Tipo</th>
          <th (click)="sort('brand')" class="sortable">
            Marca <i [class]="getSortIcon('brand')"></i>
          </th>
          <th (click)="sort('model')" class="sortable">
            Modelo <i [class]="getSortIcon('model')"></i>
          </th>
          <th (click)="sort('year')" class="sortable">
            Ano <i [class]="getSortIcon('year')"></i>
          </th>
          <th>Status</th>
          <th>Km Atual</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vehicle of vehicles">
          <td><strong>{{ vehicle.licensePlate }}</strong></td>
          <td>{{ getTypeLabel(vehicle.type) }}</td>
          <td>{{ vehicle.brand }}</td>
          <td>{{ vehicle.model }}</td>
          <td>{{ vehicle.year }}</td>
          <td>
            <span class="status" [ngClass]="getStatusClass(vehicle.status)">
              {{ getStatusLabel(vehicle.status) }}
            </span>
          </td>
          <td>{{ vehicle.currentMileage | number }} km</td>
          <td class="actions">
            <button 
              (click)="viewVehicle(vehicle)" 
              class="btn btn-sm btn-info"
              title="Visualizar">
              <i class="fas fa-eye"></i>
            </button>
            <button 
              [routerLink]="['/vehicles', vehicle.id, 'edit']" 
              class="btn btn-sm btn-secondary"
              title="Editar">
              <i class="fas fa-edit"></i>
            </button>
            <button 
              (click)="deleteVehicle(vehicle.id!)" 
              class="btn btn-sm btn-danger"
              title="Excluir">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="vehicles.length === 0">
          <td colspan="8" class="text-center">Nenhum veículo encontrado</td>
        </tr>
      </tbody>
    </table>

    <!-- Paginação -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        (click)="changePage(0)" 
        [disabled]="currentPage === 0"
        class="btn btn-sm btn-secondary"
        title="Primeira página">
        <i class="fas fa-angle-double-left"></i>
      </button>
      
      <button 
        (click)="changePage(currentPage - 1)" 
        [disabled]="currentPage === 0"
        class="btn btn-sm btn-secondary"
        title="Página anterior">
        <i class="fas fa-angle-left"></i>
      </button>

      <button 
        *ngFor="let page of getPageNumbers()" 
        (click)="changePage(page)"
        [class.active]="currentPage === page"
        class="btn btn-sm btn-secondary page-number">
        {{ page + 1 }}
      </button>

      <button 
        (click)="changePage(currentPage + 1)" 
        [disabled]="currentPage === totalPages - 1"
        class="btn btn-sm btn-secondary"
        title="Próxima página">
        <i class="fas fa-angle-right"></i>
      </button>

      <button 
        (click)="changePage(totalPages - 1)" 
        [disabled]="currentPage === totalPages - 1"
        class="btn btn-sm btn-secondary"
        title="Última página">
        <i class="fas fa-angle-double-right"></i>
      </button>

      <span class="page-info">
        Página {{ currentPage + 1 }} de {{ totalPages }}
      </span>
    </div>
  </div>
</div>

<!-- Modal de Visualização -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-car"></i> Detalhes do Veículo</h2>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedVehicle">
      <div class="detail-grid">
        <div class="detail-item">
          <label><i class="fas fa-id-card"></i> Placa:</label>
          <span class="value">{{ selectedVehicle.licensePlate }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-car-side"></i> Tipo:</label>
          <span class="value">{{ getTypeLabel(selectedVehicle.type) }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-industry"></i> Marca:</label>
          <span class="value">{{ selectedVehicle.brand }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-car"></i> Modelo:</label>
          <span class="value">{{ selectedVehicle.model }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-calendar"></i> Ano:</label>
          <span class="value">{{ selectedVehicle.year }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-info-circle"></i> Status:</label>
          <span class="status" [ngClass]="getStatusClass(selectedVehicle.status)">
            {{ getStatusLabel(selectedVehicle.status) }}
          </span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-tachometer-alt"></i> Km Atual:</label>
          <span class="value">{{ selectedVehicle.currentMileage | number }} km</span>
        </div>
        
        <div class="detail-item" *ngIf="selectedVehicle.createdAt">
          <label><i class="fas fa-calendar-plus"></i> Criado em:</label>
          <span class="value">{{ selectedVehicle.createdAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
        
        <div class="detail-item" *ngIf="selectedVehicle.updatedAt">
          <label><i class="fas fa-calendar-check"></i> Atualizado em:</label>
          <span class="value">{{ selectedVehicle.updatedAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        <i class="fas fa-times"></i> Fechar
      </button>
      <button class="btn btn-primary" [routerLink]="['/vehicles', selectedVehicle?.id, 'edit']" (click)="closeModal()">
        <i class="fas fa-edit"></i> Editar
      </button>
    </div>
  </div>
</div>
