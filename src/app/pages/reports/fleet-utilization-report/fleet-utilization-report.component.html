<div class="fleet-utilization-report">
  <div class="header">
    <h1><i class="fas fa-chart-line"></i> Relatório de Utilização de Frota</h1>
    <div class="filters">
      <div class="form-group">
        <label>Data Início:</label>
        <input type="date" [(ngModel)]="startDate" class="form-control">
      </div>
      
      <div class="form-group">
        <label>Data Fim:</label>
        <input type="date" [(ngModel)]="endDate" class="form-control">
      </div>
      
      <button (click)="loadReport()" class="btn btn-primary">
        <i class="fas fa-search"></i> Gerar Relatório
      </button>
      
      <button (click)="exportExcel()" class="btn btn-success" [disabled]="!report">
        <i class="fas fa-file-excel"></i> Excel
      </button>
      
      <button (click)="exportPDF()" class="btn btn-danger" [disabled]="!report">
        <i class="fas fa-file-pdf"></i> PDF
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Carregando relatório...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="report && !loading" class="report-content">
    <!-- Cards de Resumo -->
    <div class="summary-cards">
      <div class="card">
        <div class="card-icon"><i class="fas fa-car"></i></div>
        <div class="card-content">
          <div class="card-label">Total de Veículos</div>
          <div class="card-value">{{ report.totalVehicles }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon"><i class="fas fa-check-circle"></i></div>
        <div class="card-content">
          <div class="card-label">Veículos Ativos</div>
          <div class="card-value">{{ report.activeVehicles }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon"><i class="fas fa-pause-circle"></i></div>
        <div class="card-content">
          <div class="card-label">Veículos Ociosos</div>
          <div class="card-value">{{ report.idleVehicles }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
        <div class="card-content">
          <div class="card-label">Taxa Média Utilização</div>
          <div class="card-value">{{ report.averageUtilizationRate | number:'1.1-1' }}%</div>
        </div>
      </div>
    </div>

    <!-- Tabela de Utilização -->
    <div class="section">
      <div class="section-header">
        <h2><i class="fas fa-chart-pie"></i> Utilização por Veículo</h2>
        <span class="record-count">Mostrando {{ paginatedUtilization.length }} de {{ totalItemsUtilization }} veículos</span>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Marca/Modelo</th>
              <th>Viagens</th>
              <th>KM Total</th>
              <th>Dias em Uso</th>
              <th>Dias Parado</th>
              <th>Taxa Utilização</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of paginatedUtilization">
              <td><strong>{{ vehicle.licensePlate }}</strong></td>
              <td>{{ vehicle.brand }} {{ vehicle.model }}</td>
              <td>{{ vehicle.totalTrips }}</td>
              <td>{{ vehicle.totalKm | number }}</td>
              <td>{{ vehicle.daysInUse }}</td>
              <td>{{ vehicle.daysIdle }}</td>
              <td>{{ vehicle.utilizationRate | number:'1.1-1' }}%</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(vehicle.utilizationStatus)">
                  {{ vehicle.utilizationStatus }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination-wrapper" *ngIf="totalPagesUtilization > 1 || totalItemsUtilization > 5">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageUtilization" (change)="onPageSizeChangeUtilization($event)">
            <option *ngFor="let size of pageSizeOptionsUtilization" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageUtilization(1)"
            [disabled]="currentPageUtilization === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageUtilization(currentPageUtilization - 1)"
            [disabled]="currentPageUtilization === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesUtilization"
            class="pagination-btn"
            [class.active]="page === currentPageUtilization"
            (click)="changePageUtilization(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageUtilization(currentPageUtilization + 1)"
            [disabled]="currentPageUtilization === totalPagesUtilization">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageUtilization(totalPagesUtilization)"
            [disabled]="currentPageUtilization === totalPagesUtilization">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageUtilization }} de {{ totalPagesUtilization }} ({{ totalItemsUtilization }} itens)
        </div>
      </div>
    </div>

    <!-- Veículos Ociosos -->
    <div class="section" *ngIf="report.idleVehiclesList.length > 0">
      <div class="section-header">
        <h2><i class="fas fa-exclamation-triangle"></i> Veículos Ociosos (Mais de 30 dias parados)</h2>
        <span class="record-count">Mostrando {{ paginatedIdle.length }} de {{ totalItemsIdle }} veículos</span>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Marca/Modelo</th>
              <th>Dias Parado</th>
              <th>Última Viagem</th>
              <th>Sugestão</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of paginatedIdle">
              <td><strong>{{ vehicle.licensePlate }}</strong></td>
              <td>{{ vehicle.brand }} {{ vehicle.model }}</td>
              <td>{{ vehicle.daysIdle }} dias</td>
              <td>{{ vehicle.lastTripDate || 'Nunca' }}</td>
              <td>
                <span class="badge badge-warning">{{ vehicle.suggestion }}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination-wrapper" *ngIf="totalPagesIdle > 1 || totalItemsIdle > 5">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageIdle" (change)="onPageSizeChangeIdle($event)">
            <option *ngFor="let size of pageSizeOptionsIdle" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageIdle(1)"
            [disabled]="currentPageIdle === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageIdle(currentPageIdle - 1)"
            [disabled]="currentPageIdle === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesIdle"
            class="pagination-btn"
            [class.active]="page === currentPageIdle"
            (click)="changePageIdle(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageIdle(currentPageIdle + 1)"
            [disabled]="currentPageIdle === totalPagesIdle">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageIdle(totalPagesIdle)"
            [disabled]="currentPageIdle === totalPagesIdle">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageIdle }} de {{ totalPagesIdle }} ({{ totalItemsIdle }} itens)
        </div>
      </div>
    </div>
  </div>
</div>
