<div class="driver-list">
  <div class="header">
    <h1>Motoristas</h1>
    <div class="header-actions">
      <button (click)="toggleFilters()" class="btn btn-secondary">
        <i class="fas fa-filter"></i> {{ showFilters ? 'Ocultar Filtros' : 'Filtrar' }}
      </button>
      <button routerLink="/drivers/new" class="btn btn-primary">
        <i class="fas fa-plus"></i> Novo Motorista
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters" *ngIf="showFilters">
    <div class="filter-form">
      <div class="form-row">
        <div class="form-group">
          <label for="filterName">Nome</label>
          <input 
            type="text" 
            id="filterName" 
            [(ngModel)]="filters.name" 
            placeholder="Nome do motorista"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterCpf">CPF</label>
          <input 
            type="text" 
            id="filterCpf" 
            [(ngModel)]="filters.cpf" 
            placeholder="CPF"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterCnh">CNH</label>
          <input 
            type="text" 
            id="filterCnh" 
            [(ngModel)]="filters.cnh" 
            placeholder="Número da CNH"
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterCnhCategory">Categoria CNH</label>
          <input 
            type="text" 
            id="filterCnhCategory" 
            [(ngModel)]="filters.cnhCategory" 
            placeholder="Categoria (A, B, C, D, E)"
            class="form-control">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="filterCnhExpirationFrom">Vencimento CNH (De)</label>
          <input 
            type="date" 
            id="filterCnhExpirationFrom" 
            [(ngModel)]="filters.cnhExpirationDateFrom" 
            class="form-control">
        </div>

        <div class="form-group">
          <label for="filterCnhExpirationTo">Vencimento CNH (Até)</label>
          <input 
            type="date" 
            id="filterCnhExpirationTo" 
            [(ngModel)]="filters.cnhExpirationDateTo" 
            class="form-control">
        </div>
      </div>

      <div class="filter-actions">
        <button (click)="applyFilters()" class="btn btn-primary">
          <i class="fas fa-search"></i> Buscar
        </button>
        <button (click)="clearFilters()" class="btn btn-secondary">
          <i class="fas fa-times"></i> Limpar
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Carregando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div class="table-container" *ngIf="!loading && !error">
    <!-- Informações de paginação -->
    <div class="pagination-info">
      <div class="results-info">
        Mostrando {{ drivers.length }} de {{ totalElements }} motoristas
      </div>
      <div class="page-size-selector">
        <label for="pageSize">Itens por página:</label>
        <select id="pageSize" [(ngModel)]="pageSize" (change)="changePageSize()" class="form-control">
          <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
        </select>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th (click)="sort('name')" class="sortable">
            Nome <i [class]="getSortIcon('name')"></i>
          </th>
          <th (click)="sort('cpf')" class="sortable">
            CPF <i [class]="getSortIcon('cpf')"></i>
          </th>
          <th (click)="sort('cnh')" class="sortable">
            CNH <i [class]="getSortIcon('cnh')"></i>
          </th>
          <th (click)="sort('cnhCategory')" class="sortable">
            Categoria <i [class]="getSortIcon('cnhCategory')"></i>
          </th>
          <th (click)="sort('cnhExpirationDate')" class="sortable">
            Vencimento CNH <i [class]="getSortIcon('cnhExpirationDate')"></i>
          </th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let driver of drivers">
          <td><strong>{{ driver.name }}</strong></td>
          <td>{{ driver.cpf }}</td>
          <td>{{ driver.cnh }}</td>
          <td><span class="badge">{{ driver.cnhCategory }}</span></td>
          <td>
            <span [class.expired]="isCnhExpired(driver.cnhExpirationDate)">
              {{ driver.cnhExpirationDate | date:'dd/MM/yyyy' }}
            </span>
            <span class="warning" *ngIf="isCnhExpired(driver.cnhExpirationDate)">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
          </td>
          <td>
            <span class="status" [ngClass]="getStatusClass(driver.status)">
              {{ getStatusLabel(driver.status) }}
            </span>
          </td>
          <td class="actions">
            <button 
              (click)="viewDriver(driver)"
              class="btn btn-sm btn-info"
              title="Visualizar">
              <i class="fas fa-eye"></i>
            </button>
            <button 
              [routerLink]="['/drivers', driver.id, 'edit']" 
              class="btn btn-sm btn-secondary"
              title="Editar">
              <i class="fas fa-edit"></i>
            </button>
            <button 
              (click)="deleteDriver(driver.id!)" 
              class="btn btn-sm btn-danger"
              title="Excluir">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="drivers.length === 0">
          <td colspan="7" class="text-center">Nenhum motorista encontrado</td>
        </tr>
      </tbody>
    </table>

    <!-- Paginação -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        (click)="changePage(0)" 
        [disabled]="currentPage === 0"
        class="btn btn-sm btn-secondary"
        title="Primeira página">
        <i class="fas fa-angle-double-left"></i>
      </button>
      
      <button 
        (click)="changePage(currentPage - 1)" 
        [disabled]="currentPage === 0"
        class="btn btn-sm btn-secondary"
        title="Página anterior">
        <i class="fas fa-angle-left"></i>
      </button>

      <button 
        *ngFor="let page of getPageNumbers()" 
        (click)="changePage(page)"
        [class.active]="currentPage === page"
        class="btn btn-sm btn-secondary page-number">
        {{ page + 1 }}
      </button>

      <button 
        (click)="changePage(currentPage + 1)" 
        [disabled]="currentPage === totalPages - 1"
        class="btn btn-sm btn-secondary"
        title="Próxima página">
        <i class="fas fa-angle-right"></i>
      </button>

      <button 
        (click)="changePage(totalPages - 1)" 
        [disabled]="currentPage === totalPages - 1"
        class="btn btn-sm btn-secondary"
        title="Última página">
        <i class="fas fa-angle-double-right"></i>
      </button>

      <span class="page-info">
        Página {{ currentPage + 1 }} de {{ totalPages }}
      </span>
    </div>
  </div>
</div>

<!-- Modal de Visualização -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-user"></i> Detalhes do Motorista</h2>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedDriver">
      <div class="detail-grid">
        <div class="detail-item">
          <label><i class="fas fa-hashtag"></i> ID:</label>
          <span class="value">{{ selectedDriver.id || 'N/A' }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-user"></i> Nome:</label>
          <span class="value">{{ selectedDriver.name }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-id-card"></i> CPF:</label>
          <span class="value">{{ selectedDriver.cpf }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-id-card-alt"></i> CNH:</label>
          <span class="value">{{ selectedDriver.cnh }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-certificate"></i> Categoria CNH:</label>
          <span class="value">{{ selectedDriver.cnhCategory }}</span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-calendar-times"></i> Vencimento CNH:</label>
          <span class="value" [class.text-danger]="isCnhExpired(selectedDriver.cnhExpirationDate)">
            {{ selectedDriver.cnhExpirationDate | date: 'dd/MM/yyyy' }}
            <i class="fas fa-exclamation-triangle text-danger" *ngIf="isCnhExpired(selectedDriver.cnhExpirationDate)"></i>
          </span>
        </div>
        
        <div class="detail-item">
          <label><i class="fas fa-info-circle"></i> Status:</label>
          <span class="status" [ngClass]="getStatusClass(selectedDriver.status)">
            {{ getStatusLabel(selectedDriver.status) }}
          </span>
        </div>
        
        <div class="detail-item" *ngIf="selectedDriver.createdAt">
          <label><i class="fas fa-calendar-plus"></i> Criado em:</label>
          <span class="value">{{ selectedDriver.createdAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
        
        <div class="detail-item" *ngIf="selectedDriver.updatedAt">
          <label><i class="fas fa-calendar-check"></i> Atualizado em:</label>
          <span class="value">{{ selectedDriver.updatedAt | date: 'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">
        <i class="fas fa-times"></i> Fechar
      </button>
      <button class="btn btn-primary" (click)="closeModal()" [routerLink]="['/drivers', selectedDriver?.id, 'edit']">
        <i class="fas fa-edit"></i> Editar
      </button>
    </div>
  </div>
</div>
