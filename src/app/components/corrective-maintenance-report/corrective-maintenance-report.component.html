<div class="corrective-maintenance-report">
  <div class="header">
    <h1><i class="fas fa-tools"></i> Relatório de Manutenção Corretiva</h1>
    
    <div class="filters">
      <div class="form-group">
        <label for="startDate">Data Inicial:</label>
        <input type="date" id="startDate" class="form-control" [(ngModel)]="startDate" />
      </div>
      <div class="form-group">
        <label for="endDate">Data Final:</label>
        <input type="date" id="endDate" class="form-control" [(ngModel)]="endDate" />
      </div>
      <button class="btn btn-primary" (click)="generateReport()">
        <i class="fas fa-search"></i> Gerar Relatório
      </button>
      <button class="btn btn-success" *ngIf="report" (click)="exportToExcel()">
        <i class="fas fa-file-excel"></i> Exportar Excel
      </button>
      <button class="btn btn-danger" *ngIf="report" (click)="exportToPDF()">
        <i class="fas fa-file-pdf"></i> Exportar PDF
      </button>
    </div>
  </div>
  
  <div class="loading" *ngIf="loading">Carregando relatório...</div>
  <div class="error" *ngIf="error">{{ error }}</div>
  
  <div class="report-content" *ngIf="report && !loading">
    <div class="summary-cards">
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-wrench"></i>
        </div>
        <div class="card-content">
          <div class="card-label">Total de Manutenções Corretivas</div>
          <div class="card-value">{{ report.totalCorrectiveMaintenances }}</div>
        </div>
      </div>
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="card-content">
          <div class="card-label">Custo Total</div>
          <div class="card-value">R$ {{ report.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</div>
        </div>
      </div>
      <div class="card">
        <div class="card-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="card-content">
          <div class="card-label">Custo Médio</div>
          <div class="card-value">R$ {{ report.averageCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</div>
        </div>
      </div>
    </div>
    
    <div class="section" *ngIf="report.overdueCorrective && report.overdueCorrective.length > 0">
      <h2><i class="fas fa-exclamation-triangle"></i> Manutenções Corretivas Vencidas ({{ report.overdueCorrective.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Veículo</th>
              <th>Tipo</th>
              <th>Data Agendada</th>
              <th>Dias Atrasados</th>
              <th>Severidade</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let maintenance of report.overdueCorrective">
              <td><strong>{{ maintenance.licensePlate }}</strong></td>
              <td>{{ maintenance.brand }} {{ maintenance.model }}</td>
              <td>{{ maintenance.type }}</td>
              <td>{{ maintenance.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ maintenance.daysOverdue }} dias</td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'severity-critical': maintenance.severity === 'CRITICA',
                        'severity-high': maintenance.severity === 'ALTA',
                        'severity-medium': maintenance.severity === 'MEDIA'
                      }">
                  {{ maintenance.severity }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="section" *ngIf="report.upcomingCorrective && report.upcomingCorrective.length > 0">
      <h2><i class="fas fa-calendar-alt"></i> Manutenções Corretivas Programadas ({{ report.upcomingCorrective.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Veículo</th>
              <th>Tipo</th>
              <th>Data Agendada</th>
              <th>Dias Restantes</th>
              <th>Prioridade</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let maintenance of report.upcomingCorrective">
              <td><strong>{{ maintenance.licensePlate }}</strong></td>
              <td>{{ maintenance.brand }} {{ maintenance.model }}</td>
              <td>{{ maintenance.type }}</td>
              <td>{{ maintenance.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ maintenance.daysUntil }} dias</td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'priority-high': maintenance.priority === 'ALTA',
                        'priority-medium': maintenance.priority === 'MEDIA',
                        'priority-low': maintenance.priority === 'BAIXA'
                      }">
                  {{ maintenance.priority }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="section" *ngIf="report.topVehicles && report.topVehicles.length > 0">
      <h2><i class="fas fa-car-crash"></i> Veículos com Mais Manutenções Corretivas</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Nº de Manutenções</th>
              <th>Custo Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let vehicle of report.topVehicles">
              <td><strong>{{ vehicle.licensePlate }}</strong></td>
              <td>{{ vehicle.maintenanceCount }}</td>
              <td>R$ {{ vehicle.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="section">
      <h2><i class="fas fa-history"></i> Histórico de Manutenções Corretivas ({{ report.correctiveHistory.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Tipo</th>
              <th>Descrição</th>
              <th>Data Agendada</th>
              <th>Data Conclusão</th>
              <th>Custo</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let maintenance of report.correctiveHistory">
              <td><strong>{{ maintenance.licensePlate }}</strong></td>
              <td>{{ maintenance.type }}</td>
              <td>{{ maintenance.description }}</td>
              <td>{{ maintenance.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ maintenance.completionDate ? (maintenance.completionDate | date: 'dd/MM/yyyy') : '-' }}</td>
              <td>R$ {{ maintenance.cost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'status-completed': maintenance.status === 'COMPLETED',
                        'status-pending': maintenance.status === 'PENDING',
                        'status-scheduled': maintenance.status === 'SCHEDULED'
                      }">
                  {{ translateStatus(maintenance.status) }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
