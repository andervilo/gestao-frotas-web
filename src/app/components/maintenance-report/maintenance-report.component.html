<div class="maintenance-report">
  <div class="header">
    <h1><i class="fas fa-clipboard-list"></i> Relatório de Manutenção Preventiva</h1>
    <div class="filters">
      <div class="form-group">
        <label>Data Início:</label>
        <input type="date" id="startDate" [(ngModel)]="startDate" class="form-control" />
      </div>
      
      <div class="form-group">
        <label>Data Fim:</label>
        <input type="date" id="endDate" [(ngModel)]="endDate" class="form-control" />
      </div>
      
      <button (click)="generateReport()" class="btn btn-primary">
        <i class="fas fa-search"></i> Gerar Relatório
      </button>
      
      <button (click)="exportToExcel()" class="btn btn-success" [disabled]="!report">
        <i class="fas fa-file-excel"></i> Excel
      </button>
      
      <button (click)="exportToPDF()" class="btn btn-danger" [disabled]="!report">
        <i class="fas fa-file-pdf"></i> PDF
      </button>
    </div>
  </div>
  
  <div *ngIf="loading" class="loading">Carregando relatório...</div>
  <div *ngIf="error" class="error">{{ error }}</div>
  
  <div *ngIf="report && !loading" class="report-content">
    <!-- Cards de Resumo -->
    <div class="summary-cards">
      <div class="card">
        <div class="card-icon"><i class="fas fa-tools"></i></div>
        <div class="card-content">
          <div class="card-label">Total de Manutenções</div>
          <div class="card-value">{{ report.totalMaintenances }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="card-content">
          <div class="card-label">Preventivas</div>
          <div class="card-value">{{ report.preventiveCount }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-wrench"></i></div>
        <div class="card-content">
          <div class="card-label">Corretivas</div>
          <div class="card-value">{{ report.correctiveCount }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-dollar-sign"></i></div>
        <div class="card-content">
          <div class="card-label">Custo Total</div>
          <div class="card-value">R$ {{ report.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon"><i class="fas fa-clock"></i></div>
        <div class="card-content">
          <div class="card-label">Média de Dias em Manutenção</div>
          <div class="card-value">{{ report.averageDaysInMaintenance.toFixed(1) }}</div>
        </div>
      </div>
    </div>
    
    <!-- Manutenções Atrasadas -->
    <div class="section" *ngIf="report.overdue && report.overdue.length > 0">
      <h2><i class="fas fa-exclamation-triangle"></i> Manutenções Atrasadas ({{ totalItemsOverdue }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Veículo</th>
              <th>Tipo</th>
              <th>Data Agendada</th>
              <th>Dias Atrasados</th>
              <th>Severidade</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of paginatedOverdue">
              <td>
                <strong>{{ item.brand }} {{ item.model }}</strong><br>
                <small>{{ item.licensePlate }}</small>
              </td>
              <td>{{ item.type }}</td>
              <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ item.daysOverdue }} dias</td>
              <td>
                <span class="badge" [ngClass]="getSeverityClass(item.severity)">
                  {{ item.severity }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper" *ngIf="totalPagesOverdue > 1 || totalItemsOverdue > 10">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageOverdue" (change)="onPageSizeChangeOverdue($event)">
            <option *ngFor="let size of pageSizeOptionsOverdue" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageOverdue(1)"
            [disabled]="currentPageOverdue === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageOverdue(currentPageOverdue - 1)"
            [disabled]="currentPageOverdue === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesOverdue"
            class="pagination-btn"
            [class.active]="page === currentPageOverdue"
            (click)="changePageOverdue(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageOverdue(currentPageOverdue + 1)"
            [disabled]="currentPageOverdue === totalPagesOverdue">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageOverdue(totalPagesOverdue)"
            [disabled]="currentPageOverdue === totalPagesOverdue">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageOverdue }} de {{ totalPagesOverdue }} ({{ totalItemsOverdue }} itens)
        </div>
      </div>
    </div>
    
    <!-- Manutenções Próximas -->
    <div class="section" *ngIf="report.upcoming && report.upcoming.length > 0">
      <h2><i class="fas fa-calendar-alt"></i> Manutenções Próximas - 30 Dias ({{ totalItemsUpcoming }})</h2>
      <div class="table-container">
        <table>
          <thead>
          <tr>
            <th>Veículo</th>
            <th>Tipo</th>
            <th>Data Agendada</th>
            <th>Dias Restantes</th>
            <th>Prioridade</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of paginatedUpcoming">
            <td>
              <strong>{{ item.brand }} {{ item.model }}</strong><br>
              <small>{{ item.licensePlate }}</small>
            </td>
            <td>{{ item.type }}</td>
            <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ item.daysUntil }} dias</td>
            <td>
              <span class="badge" [ngClass]="getPriorityClass(item.priority)">
                {{ item.priority }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      
      <div class="pagination-wrapper" *ngIf="totalPagesUpcoming > 1 || totalItemsUpcoming > 10">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageUpcoming" (change)="onPageSizeChangeUpcoming($event)">
            <option *ngFor="let size of pageSizeOptionsUpcoming" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageUpcoming(1)"
            [disabled]="currentPageUpcoming === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageUpcoming(currentPageUpcoming - 1)"
            [disabled]="currentPageUpcoming === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesUpcoming"
            class="pagination-btn"
            [class.active]="page === currentPageUpcoming"
            (click)="changePageUpcoming(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageUpcoming(currentPageUpcoming + 1)"
            [disabled]="currentPageUpcoming === totalPagesUpcoming">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageUpcoming(totalPagesUpcoming)"
            [disabled]="currentPageUpcoming === totalPagesUpcoming">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageUpcoming }} de {{ totalPagesUpcoming }} ({{ totalItemsUpcoming }} itens)
        </div>
      </div>
    </div>
    
    <!-- Histórico de Manutenções -->
    <div class="section">
      <h2><i class="fas fa-history"></i> Histórico de Manutenções ({{ totalItemsHistory }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Tipo</th>
              <th>Descrição</th>
              <th>Data Agendada</th>
              <th>Data Conclusão</th>
              <th>Custo</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of paginatedHistory">
              <td><strong>{{ item.licensePlate }}</strong></td>
              <td>{{ item.type }}</td>
              <td>{{ item.description }}</td>
              <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ item.completionDate ? (item.completionDate | date: 'dd/MM/yyyy') : '-' }}</td>
              <td>R$ {{ item.cost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
              <td>{{ item.status }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper" *ngIf="totalPagesHistory > 1 || totalItemsHistory > 10">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageHistory" (change)="onPageSizeChangeHistory($event)">
            <option *ngFor="let size of pageSizeOptionsHistory" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageHistory(1)"
            [disabled]="currentPageHistory === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageHistory(currentPageHistory - 1)"
            [disabled]="currentPageHistory === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesHistory"
            class="pagination-btn"
            [class.active]="page === currentPageHistory"
            (click)="changePageHistory(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageHistory(currentPageHistory + 1)"
            [disabled]="currentPageHistory === totalPagesHistory">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageHistory(totalPagesHistory)"
            [disabled]="currentPageHistory === totalPagesHistory">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageHistory }} de {{ totalPagesHistory }} ({{ totalItemsHistory }} itens)
        </div>
      </div>
    </div>
  </div>
</div>
