<div class="maintenance-report">
  <div class="header">
    <h1><i class="fas fa-clipboard-list"></i> Relatório de Manutenção Preventiva</h1>
    <div class="filters">
      <div class="form-group">
        <label>Data Início:</label>
        <input type="date" id="startDate" [(ngModel)]="startDate" class="form-control" />
      </div>
      
      <div class="form-group">
        <label>Data Fim:</label>
        <input type="date" id="endDate" [(ngModel)]="endDate" class="form-control" />
      </div>
      
      <button (click)="generateReport()" class="btn btn-primary">
        <i class="fas fa-search"></i> Gerar Relatório
      </button>
      
      <button (click)="exportToExcel()" class="btn btn-success" [disabled]="!report">
        <i class="fas fa-file-excel"></i> Excel
      </button>
      
      <button (click)="exportToPDF()" class="btn btn-danger" [disabled]="!report">
        <i class="fas fa-file-pdf"></i> PDF
      </button>
    </div>
  </div>
  
  <div *ngIf="loading" class="loading">Carregando relatório...</div>
  <div *ngIf="error" class="error">{{ error }}</div>
  
  <div *ngIf="report && !loading" class="report-content">
    <!-- Cards de Resumo -->
    <div class="summary-cards">
      <div class="card">
        <div class="card-icon"><i class="fas fa-tools"></i></div>
        <div class="card-content">
          <div class="card-label">Total de Manutenções</div>
          <div class="card-value">{{ report.totalMaintenances }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="card-content">
          <div class="card-label">Preventivas</div>
          <div class="card-value">{{ report.preventiveCount }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-wrench"></i></div>
        <div class="card-content">
          <div class="card-label">Corretivas</div>
          <div class="card-value">{{ report.correctiveCount }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-dollar-sign"></i></div>
        <div class="card-content">
          <div class="card-label">Custo Total</div>
          <div class="card-value">R$ {{ report.totalCost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</div>
        </div>
      </div>

      <div class="card">
        <div class="card-icon"><i class="fas fa-clock"></i></div>
        <div class="card-content">
          <div class="card-label">Média de Dias em Manutenção</div>
          <div class="card-value">{{ report.averageDaysInMaintenance.toFixed(1) }}</div>
        </div>
      </div>
    </div>
    
    <!-- Manutenções Atrasadas -->
    <div class="section" *ngIf="report.overdue && report.overdue.length > 0">
      <h2><i class="fas fa-exclamation-triangle"></i> Manutenções Atrasadas ({{ report.overdue.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Veículo</th>
              <th>Tipo</th>
              <th>Data Agendada</th>
              <th>Dias Atrasados</th>
              <th>Severidade</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of report.overdue">
              <td>
                <strong>{{ item.brand }} {{ item.model }}</strong><br>
                <small>{{ item.licensePlate }}</small>
              </td>
              <td>{{ item.type }}</td>
              <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ item.daysOverdue }} dias</td>
              <td>
                <span class="badge" [ngClass]="getSeverityClass(item.severity)">
                  {{ item.severity }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Manutenções Próximas -->
    <div class="section" *ngIf="report.upcoming && report.upcoming.length > 0">
      <h2><i class="fas fa-calendar-alt"></i> Manutenções Próximas - 30 Dias ({{ report.upcoming.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
          <tr>
            <th>Veículo</th>
            <th>Tipo</th>
            <th>Data Agendada</th>
            <th>Dias Restantes</th>
            <th>Prioridade</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of report.upcoming">
            <td>
              <strong>{{ item.brand }} {{ item.model }}</strong><br>
              <small>{{ item.licensePlate }}</small>
            </td>
            <td>{{ item.type }}</td>
            <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ item.daysUntil }} dias</td>
            <td>
              <span class="badge" [ngClass]="getPriorityClass(item.priority)">
                {{ item.priority }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
      </div>
    </div>
    
    <!-- Histórico de Manutenções -->
    <div class="section">
      <h2><i class="fas fa-history"></i> Histórico de Manutenções ({{ report.history.length }})</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Placa</th>
              <th>Tipo</th>
              <th>Descrição</th>
              <th>Data Agendada</th>
              <th>Data Conclusão</th>
              <th>Custo</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of report.history">
              <td><strong>{{ item.licensePlate }}</strong></td>
              <td>{{ item.type }}</td>
              <td>{{ item.description }}</td>
              <td>{{ item.scheduledDate | date: 'dd/MM/yyyy' }}</td>
              <td>{{ item.completionDate ? (item.completionDate | date: 'dd/MM/yyyy') : '-' }}</td>
              <td>R$ {{ item.cost.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
              <td>{{ item.status }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
