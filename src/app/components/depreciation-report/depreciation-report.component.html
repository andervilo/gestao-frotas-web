<div class="report-container">
  <div class="header">
    <h2><i class="fas fa-chart-line-down"></i> Relatório de Custos Operacionais</h2>
    <div class="actions">
      <button class="btn-primary" (click)="generateReport()"><i class="fas fa-sync"></i> Atualizar Relatório</button>
      <div class="export-buttons" *ngIf="report">
        <button class="btn-secondary" (click)="exportToExcel()"><i class="fas fa-file-excel"></i> Exportar Excel</button>
        <button class="btn-secondary" (click)="exportToPDF()"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
      </div>
    </div>
  </div>
  
  <div class="loading" *ngIf="loading"><p>Carregando relatório...</p></div>
  <div class="error" *ngIf="error"><p>{{ error }}</p></div>
  
  <div class="report-content" *ngIf="report && !loading">
    <div class="summary-cards">
      <div class="summary-card">
        <h3>Valor Total da Frota</h3>
        <p class="value">R$ {{ report.totalFleetValue.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</p>
      </div>
      <div class="summary-card">
        <h3>Depreciação Total</h3>
        <p class="value">R$ {{ report.totalDepreciation.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</p>
      </div>
      <div class="summary-card">
        <h3>Idade Média da Frota</h3>
        <p class="value">{{ report.averageFleetAge }} anos</p>
      </div>
      <div class="summary-card">
        <h3>Total de Veículos</h3>
        <p class="value">{{ report.vehicleDepreciation.length }}</p>
      </div>
    </div>
    
    <div class="table-section">
      <div class="section-header">
        <h3><i class="fas fa-car"></i> Depreciação por Veículo</h3>
        <span class="record-count">Mostrando {{ paginatedVehicles.length }} de {{ totalItems }} veículos</span>
      </div>
      <table class="data-table">
        <thead>
          <tr>
            <th>Veículo</th>
            <th>Ano</th>
            <th>Idade (anos)</th>
            <th>Data Compra</th>
            <th>Valor Compra</th>
            <th>Valor Atual</th>
            <th>Depreciação</th>
            <th>Taxa (%)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let vehicle of paginatedVehicles">
            <td>
              <strong>{{ vehicle.brand }} {{ vehicle.model }}</strong><br>
              <small>{{ vehicle.licensePlate }}</small>
            </td>
            <td>{{ vehicle.year }}</td>
            <td>{{ vehicle.ageInYears }}</td>
            <td>{{ vehicle.purchaseDate | date: 'dd/MM/yyyy' }}</td>
            <td>R$ {{ vehicle.purchaseValue.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
            <td>R$ {{ vehicle.currentValue.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
            <td>R$ {{ vehicle.totalDepreciation.toLocaleString('pt-BR', {minimumFractionDigits: 2}) }}</td>
            <td>{{ vehicle.depreciationRate.toFixed(2) }}%</td>
          </tr>
        </tbody>
      </table>
      
      <div class="pagination-wrapper" *ngIf="totalPages > 1 || totalItems > 5">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPage" (change)="onPageSizeChange($event)">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePage(1)"
            [disabled]="currentPage === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pages"
            class="pagination-btn"
            [class.active]="page === currentPage"
            (click)="changePage(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePage(totalPages)"
            [disabled]="currentPage === totalPages">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPage }} de {{ totalPages }} ({{ totalItems }} itens)
        </div>
      </div>
    </div>
  </div>
</div>
