<div class="driver-performance-report">
  <div class="header">
    <h1><i class="fas fa-user-tie"></i> Relatório de Desempenho de Motoristas</h1>
    <div class="filters">
      <div class="form-group">
        <label>Data Início:</label>
        <input type="date" id="startDate" [(ngModel)]="startDate" class="form-control" />
      </div>
      
      <div class="form-group">
        <label>Data Fim:</label>
        <input type="date" id="endDate" [(ngModel)]="endDate" class="form-control" />
      </div>
      
      <button (click)="generateReport()" class="btn btn-primary">
        <i class="fas fa-search"></i> Gerar Relatório
      </button>
      
      <button (click)="exportToExcel()" class="btn btn-success" [disabled]="!report">
        <i class="fas fa-file-excel"></i> Excel
      </button>
      
      <button (click)="exportToPDF()" class="btn btn-danger" [disabled]="!report">
        <i class="fas fa-file-pdf"></i> PDF
      </button>
    </div>
  </div>
  
  <div *ngIf="loading" class="loading">Carregando relatório...</div>
  <div *ngIf="error" class="error">{{ error }}</div>
  
  <div *ngIf="report && !loading" class="report-content">
    <!-- Cards de Resumo -->
    <div class="summary-cards">
      <div class="card">
        <div class="card-icon"><i class="fas fa-users"></i></div>
        <div class="card-content">
          <div class="card-label">Total de Motoristas</div>
          <div class="card-value">{{ report.totalDrivers || 0 }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-user-check"></i></div>
        <div class="card-content">
          <div class="card-label">Motoristas Ativos</div>
          <div class="card-value">{{ report.activeDrivers || 0 }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-id-card"></i></div>
        <div class="card-content">
          <div class="card-label">CNHs Expirando</div>
          <div class="card-value">{{ report.cnhExpiring.length || 0 }}</div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
        <div class="card-content">
          <div class="card-label">Estatísticas Disponíveis</div>
          <div class="card-value">{{ report.driverStats.length || 0 }}</div>
        </div>
      </div>
    </div>
    
    <div class="tabs-container">
      <div class="tabs-header">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'cnh'"
          (click)="activeTab = 'cnh'"
          *ngIf="report.cnhExpiring && report.cnhExpiring.length > 0">
          <i class="fas fa-exclamation-triangle"></i> CNHs Vencendo ({{ totalItemsCNH }})
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'stats'"
          (click)="activeTab = 'stats'"
          *ngIf="report.driverStats && report.driverStats.length > 0">
          <i class="fas fa-chart-line"></i> Estatísticas ({{ totalItemsStats }})
        </button>
      </div>
      
      <div class="tab-content">
        <div class="section" *ngIf="activeTab === 'cnh' && report.cnhExpiring && report.cnhExpiring.length > 0">
          <div class="section-header">
            <h2><i class="fas fa-exclamation-triangle"></i> CNHs Próximas do Vencimento</h2>
            <span class="record-count">Mostrando {{ paginatedCNH.length }} de {{ totalItemsCNH }} motoristas</span>
          </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Motorista</th>
              <th>CNH</th>
              <th>Data de Vencimento</th>
              <th>Dias até Vencer</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let driver of paginatedCNH">
              <td><strong>{{ driver.name }}</strong></td>
              <td>{{ driver.cnh }}</td>
              <td>{{ driver.cnhExpiration | date: 'dd/MM/yyyy' }}</td>
              <td>{{ driver.daysUntilExpiration }} dias</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(driver.status)">
                  {{ driver.status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper" *ngIf="totalPagesCNH > 1 || totalItemsCNH > 5">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageCNH" (change)="onPageSizeChangeCNH($event)">
            <option *ngFor="let size of pageSizeOptionsCNH" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageCNH(1)"
            [disabled]="currentPageCNH === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageCNH(currentPageCNH - 1)"
            [disabled]="currentPageCNH === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesCNH"
            class="pagination-btn"
            [class.active]="page === currentPageCNH"
            (click)="changePageCNH(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageCNH(currentPageCNH + 1)"
            [disabled]="currentPageCNH === totalPagesCNH">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageCNH(totalPagesCNH)"
            [disabled]="currentPageCNH === totalPagesCNH">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageCNH }} de {{ totalPagesCNH }} ({{ totalItemsCNH }} itens)
        </div>
      </div>
    </div>
        
        <div class="section" *ngIf="activeTab === 'stats' && report.driverStats && report.driverStats.length > 0">
          <div class="section-header">
            <h2><i class="fas fa-chart-line"></i> Estatísticas de Desempenho</h2>
            <span class="record-count">Mostrando {{ paginatedStats.length }} de {{ totalItemsStats }} motoristas</span>
          </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Motorista</th>
              <th>CNH</th>
              <th>Total Viagens</th>
              <th>Total Km</th>
              <th>Taxa de Utilização</th>
              <th>Ranking</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let driver of paginatedStats">
              <td><strong>{{ driver.name }}</strong></td>
              <td>{{ driver.cnh }}</td>
              <td>{{ driver.totalTrips }}</td>
              <td>{{ driver.totalKm.toLocaleString('pt-BR') }}</td>
              <td>{{ driver.utilizationRate.toFixed(2) }}%</td>
              <td>
                <span class="badge" [ngClass]="getRankingClass(driver.ranking)">
                  #{{ driver.ranking }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper" *ngIf="totalPagesStats > 1 || totalItemsStats > 5">
        <div class="pagination-left">
          <label>Itens por página:</label>
          <select class="page-size-select" [(ngModel)]="itemsPerPageStats" (change)="onPageSizeChangeStats($event)">
            <option *ngFor="let size of pageSizeOptionsStats" [value]="size">{{ size }}</option>
          </select>
        </div>
        
        <div class="pagination-center">
          <button 
            class="pagination-btn" 
            (click)="changePageStats(1)"
            [disabled]="currentPageStats === 1">
            <i class="fas fa-angle-double-left"></i>
          </button>
          
          <button 
            class="pagination-btn" 
            (click)="changePageStats(currentPageStats - 1)"
            [disabled]="currentPageStats === 1">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <button 
            *ngFor="let page of pagesStats"
            class="pagination-btn"
            [class.active]="page === currentPageStats"
            (click)="changePageStats(page)">
            {{ page }}
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageStats(currentPageStats + 1)"
            [disabled]="currentPageStats === totalPagesStats">
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <button 
            class="pagination-btn"
            (click)="changePageStats(totalPagesStats)"
            [disabled]="currentPageStats === totalPagesStats">
            <i class="fas fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="pagination-right">
          Página {{ currentPageStats }} de {{ totalPagesStats }} ({{ totalItemsStats }} itens)
        </div>
      </div>
    </div>
      </div>
    </div>
  </div>
</div>
